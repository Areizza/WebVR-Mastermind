<!DOCTYPE html>
<html>
    <head>
        <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.js"></script>
        <script src="https://unpkg.com/aframe-physics-extras@0.1.2/dist/aframe-physics-extras.js"></script>
        <script src="https://unpkg.com/aframe-event-set-component@^4.0.0/dist/aframe-event-set-component.js"></script>
        <script src="https://unpkg.com/super-hands@3.0.0/dist/super-hands.js"></script>
        <script src="/socket.io/socket.io.js"></script>

        <script>
            function detectMobile() { //to detect if the device is smaller (make it easier instead of installing that whole library)
                return (( window.innerWidth <= 1080 ));
            }

            if (detectMobile() == true){ //redirect to the controller page
                window.location.replace("/controller")
            }

            let socket = io();

            socket.on('connect', function(){
                console.log("I am connected too");
            });

            //listening for 'color_change' event then using the data/object sent to change colour
            socket.on('color_change', function(data){
                let colorStr = 'rgb(' + data.r + ',' + data.g + ',' + data.b + ')';
                console.log('color received: ' + colorStr);

                //set background colour
                document.body.style.backgroundColor = colorStr;
            });
        </script>
    </head>
    <body>
        <a-scene >
            <!-- environment -->
            <a-entity id="groundPlane"
                      position="0 0 0"
                      rotation="-90 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 10;"
                      material="color: grey; metalness: 0.5"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="frontWall"
                      position="0 1.5 -5"
                      rotation="0 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 3;"
                      material="color: grey; metalness: 0.5;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="leftWall"
                      position="-5 5 0"
                      rotation="0 90 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 10;"
                      material="color: grey; metalness: 1;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="backWall"
                      position="0 5 5"
                      rotation="-180 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 10;"
                      material="color: grey; metalness: 0.5;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="rightWall"
                      position="5 5 0"
                      rotation="0 -90 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 10;"
                      material="color: grey; metalness: 1;"
                      static-body
                      shadow>
            </a-entity>
            <a-entity id="roof"
                      position="0 10 0"
                      rotation="90 0 0"
                      scale="1 1 1"
                      geometry="primitive: plane; width: 10; height: 10;"
                      material="color: grey; metalness: 0.5;"
                      static-body
                      shadow>
            </a-entity>

            
            <a-entity   geometry="primitive: box; width: 1; height: 1; depth: 1;"
                        position="0 0.6 -1"
                        hoverable grabbable draggable droppable
                        class="grabbable"
                        dynamic-body="shape: box; mass: 2;"
                        material="color: blue; metalness: 0.2;"
                        shadow
                        event-set__hoveron="_event: hover-start; material.opacity: 0.8; transparent: true"
                        event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false">
            </a-entity>

            <a-entity   geometry="primitive: sphere; radius: 1;"
                        position="0 0.6 -1"
                        hoverable grabbable draggable droppable
                        class="grabbable"
                        dynamic-body="shape: sphere; mass: 2;"
                        material="color: red; metalness: 0.2;"
                        shadow
                        event-set__hoveron="_event: hover-start; material.opacity: 0.8; transparent: true"
                        event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false">
            </a-entity>

            <a-entity   geometry="primitive: cylinder; radius: 1;"
                        position="0 0.6 -1"
                        hoverable grabbable draggable droppable
                        class="grabbable"
                        dynamic-body="shape: cylinder; mass: 2;"
                        material="color: green; metalness: 0.2;"
                        shadow
                        event-set__hoveron="_event: hover-start; material.opacity: 0.8; transparent: true"
                        event-set__hoveroff="_event: hover-end; material.opacity: 1; transparent: false">
            </a-entity>

            <!-- lights -->
            <a-entity light="type: point; color: #CCC; intensity: 0.25"
                      position="5 10 5">
            </a-entity>
            <a-entity light="type: point; color: #CCC; intensity: 0.25"
                      position="-5 10 -5">
            </a-entity>
            <a-entity light="type: point; color: #CCC; intensity: 0.25"
                      position="5 10 -5">
            </a-entity>
            <a-entity light="type: point; color: #CCC; intensity: 0.25"
                      position="-5 10 5">
            </a-entity>
            <a-entity light="type: ambient; color: #CCC; intensity: 0.2">
            </a-entity>

            <!-- camera and cursor -->
            <a-entity camera
                      wasd-controls
                      look-controls="pointerLockEnabled:true"
                      position="0 2 1.5"
                      raycaster="objects: .grabbable; far: 5; interval: 100;"
                      cursor="rayOrigin:mouse"
                      static-body="shape: sphere;"
                      super-hands="colliderEvent: raycaster-intersection;
                             colliderEventProperty: els;
                             colliderEndEvent:raycaster-intersection-cleared;
                             colliderEndEventProperty: clearedEls;">
                             
                             <a-entity  cursor="fuse: true; fusetimeout: 500"
                                        super-hands="colliderevent: raycaster-intersection;
                                            collidereventproperty: els;
                                            colliderendevent: raycaster-intersection-cleared;
                                            colliderendeventproperty: clearedels"
                                        geometry="primitive: ring; radiusInner: 0.015; radiusOuter: 0.02"
                                        material="color: red; shader: flat"
                                        position="0 0 -0.5">
                            </a-entity>
            </a-entity>
        </a-scene>
    </body>
</html>